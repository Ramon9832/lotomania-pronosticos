<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lotomania PRO ‚Äì Filtro 20 Puntos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:'Segoe UI',Arial;background:#f0f4f7;padding:20px;color:#333}
h1{text-align:center;color:#1b5e20}
.box{background:#fff;padding:15px;border-radius:12px;margin:10px auto;max-width:900px;box-shadow:0 4px 6px rgba(0,0,0,0.1)}
.num{background:#2e7d32;color:#fff;padding:4px 6px;border-radius:4px;font-size:12px;min-width:22px;text-align:center}
button{padding:12px 20px;font-size:16px;margin:10px auto;display:inline-block;cursor:pointer;border-radius:8px;border:none;background:#1b5e20;color:white;transition:0.3s}
button:hover{background:#2e7d32}
.btn-save{background:#0277bd;margin-left:10px}
.game{margin-bottom:10px;font-family:monospace;font-size:14px;background:#f9f9f9;padding:8px;border-left:4px solid #2e7d32; word-break: break-all;}
.controls{text-align:center}
#estado-busqueda { font-weight: bold; color: #d32f2f; }
</style>
</head>

<body>

<h1>üéØ Lotomania PRO: Filtro de Cuadrantes</h1>

<div class="box">
    <p><b>üìä Estado:</b> <span id="fecha">Cargando datos...</span> | <b>Sorteos:</b> <span id="total">0</span></p>
    <p id="estado-busqueda"></p>
</div>

<div class="box controls">
    <label>Cantidad de jugadas:</label>
    <select id="cantidad">
        <option>5</option><option>10</option><option>20</option>
    </select>
    <button onclick="generar()">üîÑ Generar y Filtrar</button>
    <button class="btn-save" onclick="descargarTXT()">üíæ Guardar TXT</button>
</div>

<div class="box">
    <h2>üéüÔ∏è Jugadas de Alta Probabilidad (Filtro 16-20 aciertos)</h2>
    <div id="jugadas"></div>
</div>

<script>
// Usamos un proxy para evitar el error de "Sincronizando" (CORS)
const URL_ORIGINAL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5zTmvIQ_c4bX9ADf1JzSKvivksl2Mkejdu9cvwrSwjvqB1_f2xSBudShflElF0CBMsJ260c_Beodx/pub?gid=0&single=true&output=csv";
const CSV = "https://api.allorigins.win/raw?url=" + encodeURIComponent(URL_ORIGINAL);

let freq = {};
let jugadasFinales = [];

async function cargar(){
    document.getElementById("fecha").textContent = "Conectando con Google Sheets...";
    freq = {};
    try {
        let r = await fetch(CSV);
        if (!r.ok) throw new Error("Error en respuesta");
        let t = await r.text();
        let rows = t.trim().split("\n");
        
        document.getElementById("total").textContent = rows.length;
        document.getElementById("fecha").textContent = "Sincronizado: " + (rows[0].split(",")[1] || "√âxito");

        for(let i=0; i<100; i++) freq[i.toString().padStart(2,"0")] = 0;
        
        rows.forEach(l => {
            let c = l.split(",");
            if(!c[2]) return;
            c[2].split(" ").forEach(n => {
                n = n.padStart(2,"0");
                if(freq[n] !== undefined) freq[n]++;
            });
        });
        return true;
    } catch(e) { 
        document.getElementById("fecha").textContent = "Error de conexi√≥n. Intente de nuevo.";
        console.error(e);
        return false;
    }
}

function esValida(jugada) {
    // FILTRO 1: Par/Impar (Equilibrio real 22-28)
    let pares = jugada.filter(n => parseInt(n) % 2 === 0).length;
    if (pares < 22 || pares > 28) return false;

    // FILTRO 2: Cuadrantes (M√≠nimo 8, M√°ximo 18 por zona)
    let c1=0, c2=0, c3=0, c4=0;
    jugada.forEach(n => {
        let num = parseInt(n);
        let fila = Math.floor(num/10);
        let col = num % 10;
        if(fila < 5 && col < 5) c1++;
        else if(fila < 5 && col >= 5) c2++;
        else if(fila >= 5 && col < 5) c3++;
        else c4++;
    });
    if([c1,c2,c3,c4].some(c => c < 8 || c > 18)) return false;

    // FILTRO 3: TRUCO PRO - No m√°s de 3 n√∫meros seguidos (Rachas imposibles)
    let seguidos = 1;
    for(let i=0; i < jugada.length - 1; i++){
        if(parseInt(jugada[i+1]) === parseInt(jugada[i]) + 1) {
            seguidos++;
            if(seguidos > 3) return false; // Descarta si hay 4 o m√°s seguidos
        } else {
            seguidos = 1;
        }
    }

    return true;
}

async function generar(){
    let exito = await cargar();
    if(!exito) return;

    jugadasFinales = [];
    let jDiv = document.getElementById("jugadas");
    jDiv.innerHTML = "<p>Buscando combinaciones que cumplan los filtros...</p>";

    // Regla: 8 por decena (n√∫cleo s√≥lido)
    let base80 = [];
    for(let d=0; d<10; d++) { 
        for(let n=2; n<=9; n++) { 
            base80.push((d*10 + n).toString().padStart(2,"0")); 
        } 
    }

    let restantes = [];
    for(let i=0; i<100; i++){
        let n = i.toString().padStart(2,"0");
        if(!base80.includes(n)) restantes.push(n);
    }
    restantes.sort((a,b) => freq[b] - freq[a]);
    let universo = [...base80, ...restantes.slice(0, 5)];

    let cant = parseInt(document.getElementById("cantidad").value);
    let intentos = 0;

    while(jugadasFinales.length < cant && intentos < 5000){
        let combo = [...universo].sort(()=>0.5-Math.random()).slice(0, 50).sort((a,b)=>a-b);
        if(esValida(combo)){
            jugadasFinales.push(combo);
        }
        intentos++;
    }

    jDiv.innerHTML = "";
    jugadasFinales.forEach((jg, index) => {
        let g = document.createElement("div");
        g.className = "game";
        g.innerHTML = <strong>JUEGO ${index+1}:</strong> ${jg.join(" - ")};
        jDiv.appendChild(g);
    });
}

function descargarTXT() {
    if(jugadasFinales.length === 0) return alert("Primero genera las jugadas");
    let contenido = "PREDICCI√ìN LOTOMANIA PRO\n" + "========================\n";
    jugadasFinales.forEach((jg, i) => {
        contenido += Juego ${i+1}: ${jg.join(",")}\n;
    });
    const blob = new Blob([contenido], {type: 'text/plain'});
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'jugadas_lotomania.txt';
    a.click();
}
</script>

</body>
</html>
