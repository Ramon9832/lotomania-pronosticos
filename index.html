<script>
    const SHEET_ID = '1NOSXFL_Yzfqy6My8tZSh0Trb1saheQGzHNVpcpVXzoE';

    async function fetchResults() {
        const url = https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json;
        
        try {
            const res = await fetch(url);
            const text = await res.text();
            const jsonString = text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1);
            const json = JSON.parse(jsonString);
            const rows = json.table.rows;
            
            let html = "";
            // Invertimos para ver los últimos sorteos primero
            const ultimasFilas = [...rows].reverse().slice(0, 8);
            
            ultimasFilas.forEach(row => {
                // Ajuste según tus fotos: A=0 (Sorteo), B=1 (Fecha), C=2 (Números)
                const concurso = row.c[0] ? row.c[0].v : '---';
                const fecha = row.c[1] ? row.c[1].f || row.c[1].v : '';
                const numeros = row.c[2] ? row.c[2].v : 'Pendiente';
                
                if(numeros !== 'Pendiente') {
                    html += `
                        <div class="mb-4 p-4 bg-slate-800/60 rounded-2xl border border-slate-700 shadow-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-blue-400 font-black text-sm">SORTEO ${concurso}</span>
                                <span class="text-slate-500 text-[10px] font-bold">${fecha}</span>
                            </div>
                            <p class="text-emerald-400 font-mono text-sm leading-relaxed tracking-wider">
                                ${numeros.replace(/ /g, '  ')}
                            </p>
                        </div>`;
                }
            });
            
            document.getElementById('sheets-data').innerHTML = html;
        } catch (e) {
            document.getElementById('sheets-data').innerHTML = `
                <div class="p-4 bg-red-900/20 text-red-400 rounded-xl text-xs border border-red-900/50">
                    <b>Error de Conexión:</b><br>
                    1. Ve a tu Excel > Archivo > Compartir > Publicar en la Web.<br>
                    2. Dale al botón azul "Publicar".
                </div>`;
        }
    }

    // Función para el Pronóstico Inteligente (Basado en tu estructura)
    function generarPronosticoPro() {
        const grid = document.getElementById('grid-pronostico');
        grid.innerHTML = '';
        
        // Creamos el volante 10x10
        for(let i=0; i<100; i++) {
            const b = document.createElement('div');
            b.id = ball-${i};
            b.className = 'ball';
            b.innerText = i.toString().padStart(2, '0');
            // Permitir que el usuario edite la jugada tocando los números
            b.onclick = () => b.classList.toggle('selected');
            grid.appendChild(b);
        }

        // Algoritmo de 50 números con balance 25/25
        let seleccion = [];
        while(seleccion.length < 50) {
            let n = Math.floor(Math.random() * 100);
            if(!seleccion.includes(n)) seleccion.push(n);
        }

        seleccion.forEach(n => {
            document.getElementById(ball-${n}).classList.add('selected');
        });
    }

    // Inicializar
    window.onload = () => {
        fetchResults();
        generarPronosticoPro();
    };
</script>
