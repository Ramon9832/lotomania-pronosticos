<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>LotomanÃ­a â€“ Sistema Profesional MÃ¡ximo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#111">

<style>
body{font-family:Arial;background:#f2f2f2;padding:15px}
h2,h3{margin-top:0}
textarea{width:100%}
button{padding:10px;margin-top:8px;font-size:15px}
.box{background:#fff;padding:12px;margin-top:15px;border-radius:6px}
.nums{font-family:monospace;line-height:1.6}
.estado{font-weight:bold}
</style>
</head>

<body>

<h2>ğŸ¯ LotomanÃ­a â€“ Sistema Profesional MÃ¡ximo</h2>

<div class="box">
<h3>1ï¸âƒ£ Ingresar sorteos histÃ³ricos</h3>
<textarea id="sorteos" rows="5"
placeholder="Cada lÃ­nea = un sorteo (50 nÃºmeros separados por coma)"></textarea>
<button onclick="procesar()">Generar jugadas</button>
</div>

<div class="box">
<h3>ğŸ”’ NÃºcleo Profesional</h3>
<div id="nucleo" class="nums"></div>
</div>

<div class="box">
<h3>ğŸ…°ï¸ Juego A (Tendencia)</h3>
<div id="juegoA" class="nums"></div>
</div>

<div class="box">
<h3>ğŸ…±ï¸ Juego B (Retorno)</h3>
<div id="juegoB" class="nums"></div>
</div>

<div class="box">
<h3>2ï¸âƒ£ Ingresar resultado del sorteo</h3>
<textarea id="resultado" rows="3"
placeholder="Resultado oficial (50 nÃºmeros separados por coma)"></textarea>
<button onclick="evaluar()">Evaluar sistema</button>
</div>

<div class="box">
<h3>ğŸ“Š Estado del sistema</h3>
<div id="analisis"></div>
</div>

<script>
// =================== CONFIGURACIÃ“N ===================
const LIMITE_AJUSTE = 0.3;
const BASE_NUCLEO = [
2,5,11,14,18,21,24,27,32,35,
38,41,44,49,52,55,60,65,72,77,84,88
];

// =================== UTILIDADES ===================
function fmt(arr){
 return arr.sort((a,b)=>a-b).map(n=>String(n).padStart(2,"0")).join(" â€“ ");
}
function getLS(k,v){ return JSON.parse(localStorage.getItem(k))||v }
function setLS(k,v){ localStorage.setItem(k,JSON.stringify(v)) }

// =================== PROCESAR ===================
function procesar(){
 const texto=document.getElementById("sorteos").value.trim();
 if(!texto)return alert("Ingrese sorteos");

 const sorteos=texto.split("\n").map(l=>l.split(",").map(n=>+n));
 const freq={};

 sorteos.flat().forEach(n=>freq[n]=(freq[n]||0)+1);

 let nucleo=getLS("nucleo",BASE_NUCLEO);

 const disponibles=Object.keys(freq).map(Number).filter(n=>!nucleo.includes(n));
 disponibles.sort((a,b)=>freq[b]-freq[a]);

 const juegoA=nucleo.concat(disponibles.slice(0,50-nucleo.length));
 const juegoB=nucleo.concat(disponibles.slice(-(50-nucleo.length)));

 document.getElementById("nucleo").innerText=fmt(nucleo);
 document.getElementById("juegoA").innerText=fmt(juegoA);
 document.getElementById("juegoB").innerText=fmt(juegoB);
}

// =================== EVALUAR ===================
function evaluar(){
 const res=document.getElementById("resultado").value
 .split(",").map(n=>+n);

 let nucleo=getLS("nucleo",BASE_NUCLEO);
 let historial=getLS("historial",[]);

 const aciertos=nucleo.filter(n=>res.includes(n)).length;

 historial.push({fecha:new Date().toLocaleDateString(),aciertos});
 setLS("historial",historial);

 let estado="ğŸŸ¢ SISTEMA SANO";
 if(aciertos>=12)estado="ğŸ”¥ SISTEMA EN ALTA";
 if(aciertos<8)estado="ğŸ”´ ALERTA";

 if(historial.length>=2){
   const ult=historial.slice(-2);
   if(ult.every(h=>h.aciertos<8)){
     nucleo=ajustarNucleo(nucleo,historial);
     setLS("nucleo",nucleo);
     estado+=" â€“ NÃšCLEO AJUSTADO";
   }
 }

 document.getElementById("analisis").innerHTML=
 `Aciertos del nÃºcleo: <b>${aciertos}</b><br>
 Estado: <span class="estado">${estado}</span><br>
 Sorteos analizados: ${historial.length}`;
}

// =================== AJUSTE AUTOMÃTICO ===================
function ajustarNucleo(nucleo,hist){
 const freq={};
 hist.forEach(h=>{
  (h.resultado||[]).forEach(n=>freq[n]=(freq[n]||0)+1)
 });

 const quitar=Math.floor(nucleo.length*LIMITE_AJUSTE);
 const perdedores=[...nucleo]
 .sort((a,b)=>(freq[a]||0)-(freq[b]||0))
 .slice(0,quitar);

 const candidatos=Object.keys(freq).map(Number)
 .filter(n=>!nucleo.includes(n))
 .sort((a,b)=>freq[b]-freq[a])
 .slice(0,quitar);

 return nucleo.filter(n=>!perdedores.includes(n)).concat(candidatos);
}

// =================== PWA ===================
if("serviceWorker"in navigator){
 const swCode=`
 self.addEventListener("install",e=>{
 e.waitUntil(caches.open("lotomania").then(c=>c.addAll(["./"])))
 });
 self.addEventListener("fetch",e=>{
 e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))
 });`;
 const blob=new Blob([swCode],{type:"text/javascript"});
 navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>

</body>
</html>
