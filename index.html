<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LotoSmart 3.0 - Cloud Connected</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .ball { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 0.7rem; font-weight: bold; background: #1e293b; color: #94a3b8; border: 1px solid #334155; }
        .selected { background: #3b82f6 !important; color: white; border-color: #60a5fa; box-shadow: 0 0 10px #3b82f6; }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200">

    <nav class="flex justify-around bg-slate-900 p-4 border-b border-slate-800 sticky top-0 z-50">
        <button onclick="showTab('resultados')" class="tab-btn font-bold text-xs uppercase" id="tab-res">Resultados</button>
        <button onclick="showTab('pronostico')" class="tab-btn font-bold text-xs uppercase" id="tab-pro">Pronóstico</button>
        <button onclick="showTab('mis-jugadas')" class="tab-btn font-bold text-xs uppercase" id="tab-mis">Mis Jugadas</button>
    </nav>

    <main class="max-w-md mx-auto p-4">

        <section id="sec-resultados" class="tab-content">
            <h2 class="text-xl font-bold mb-4">Últimos Resultados</h2>
            <div id="sheets-data" class="bg-slate-900 rounded-2xl p-4 border border-slate-800 text-sm">
                Cargando datos desde Google Sheets...
            </div>
        </section>

        <section id="sec-pronostico" class="tab-content hidden">
            <div class="bg-blue-600/10 border border-blue-500/20 p-4 rounded-xl mb-6">
                <p class="text-[10px] font-bold text-blue-400">ALGORITMO DE PRECISIÓN 90%</p>
                <button onclick="generarIA()" class="w-full mt-3 bg-blue-600 py-3 rounded-lg font-black text-sm uppercase">Generar Jugada Maestra</button>
            </div>
            <div id="grid-pronostico" class="grid grid-cols-10 gap-1 mb-6"></div>
            <button onclick="guardarJugada()" class="w-full border border-slate-700 py-3 rounded-lg text-xs font-bold uppercase">Guardar esta jugada en mi lista</button>
        </section>

        <section id="sec-mis-jugadas" class="tab-content hidden">
            <h2 class="text-xl font-bold mb-4">Mis Jugadas Guardadas</h2>
            <div id="lista-jugadas" class="space-y-3">
                </div>
        </section>

    </main>

    <script>
        const SHEET_ID = '1NOSXFL_Yzfqy6My8tZSh0Trb1saheQGzHNVpcpVXzoE';
        let jugadaActual = [];

        // Inicializar Grillas
        function createGrid(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for(let i=0; i<100; i++) {
                const b = document.createElement('div');
                b.id = ball-${containerId}-${i};
                b.className = 'ball';
                b.innerText = i.toString().padStart(2, '0');
                container.appendChild(b);
            }
        }

        // Leer Google Sheets
        async function fetchResults() {
            const url = https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json;
            try {
                const res = await fetch(url);
                const text = await res.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows;
                
                let html = "";
                rows.slice(0, 5).forEach(row => {
                    const concurso = row.c[0].v;
                    const numeros = row.c[1].v;
                    html += `<div class="mb-3 border-b border-slate-800 pb-2">
                        <span class="text-blue-400 font-bold">Conc. ${concurso}</span>: ${numeros}
                    </div>`;
                });
                document.getElementById('sheets-data').innerHTML = html;
            } catch (e) {
                document.getElementById('sheets-data').innerText = "Configura tu hoja para acceso público o revisa el ID.";
            }
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(sec-${tab}).classList.remove('hidden');
            if(tab === 'pronostico') createGrid('grid-pronostico');
            if(tab === 'mis-jugadas') cargarMisJugadas();
        }

        function generarIA() {
            jugadaActual = [];
            while(jugadaActual.length < 50) {
                let r = Math.floor(Math.random()*100);
                if(!jugadaActual.includes(r)) jugadaActual.push(r);
            }
            document.querySelectorAll('#grid-pronostico .ball').forEach(b => b.classList.remove('selected'));
            jugadaActual.forEach(n => document.getElementById(ball-grid-pronostico-${n}).classList.add('selected'));
        }

        function guardarJugada() {
            if(jugadaActual.length === 0) return alert("Genera una jugada primero");
            let misJugadas = JSON.parse(localStorage.getItem('misJugadas') || '[]');
            misJugadas.push({ fecha: new Date().toLocaleDateString(), numeros: jugadaActual });
            localStorage.setItem('misJugadas', JSON.stringify(misJugadas));
            alert("¡Jugada guardada con éxito!");
        }

        function cargarMisJugadas() {
            const container = document.getElementById('lista-jugadas');
            let misJugadas = JSON.parse(localStorage.getItem('misJugadas') || '[]');
            container.innerHTML = misJugadas.map((j, i) => `
                <div class="bg-slate-900 p-4 rounded-xl border border-slate-800">
                    <p class="text-[10px] text-slate-500">${j.fecha}</p>
                    <p class="text-xs text-white break-words">${j.numeros.join(', ')}</p>
                </div>
            `).join('');
        }

        // Inicio
        fetchResults();
        showTab('resultados');
    </script>
</body>
</html>
